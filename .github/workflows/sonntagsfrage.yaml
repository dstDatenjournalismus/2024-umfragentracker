name: Download Sonntagsfrage

on:
  schedule:
    # Runs at 00:00 UTC every day
    - cron: '0 0 * * *'
  workflow_dispatch:
    # Allows manual triggering of the workflow

jobs:
  download-file:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Create data_raw directory
        run: mkdir -p data_raw

      - name: Download Data
        run: |
                wget --header="Authorization: Bearer ${{ secrets.BEARER_TOKEN }}" -O data_raw/sonntagsfrage.csv https://api.apa.at/data/dossiers/datenpunkt_demokratie/sonntagsfrage/dossier_sonntagsfrage/nationalrat_details.csv

      - name: Save download time
        run: echo $(date) > data_raw/sonntagsfrage_downloadtime.txt

      - name: Commit files
        run: |
          git config --local user.name actions-user
          git config --local user.email "actions@github.com"
          git add -A
          git commit -am "Sonntagsfrage download at: $(date)"
          git push origin main
        env:
          REPO_KEY: ${{secrets.GITHUB_TOKEN}}
          username: github-actions
